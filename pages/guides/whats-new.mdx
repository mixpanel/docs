---
title: "What's New"
description: "Auto-updating highlights from Mixpanel Changelogs"
---

import { useEffect, useMemo, useState } from 'react'

/* Save as: pages/guides/whats-new.mdx */

const REPO_LIST_URL =
  'https://api.github.com/repos/mixpanel/docs/contents/pages/changelogs?ref=main'

const DEFAULT_LIMIT = 10
const FETCH_COUNT = 30

function PageHeader({ count30d }) {
  return (
    <div className="mx-auto max-w-5xl mb-6">
      <h1 className="text-3xl font-semibold tracking-tight">Whatâ€™s New</h1>
      <p className="mt-1 text-sm text-gray-500">
        Fresh from our <a className="underline" href="/changelogs">Changelog</a>.
        We shipped <strong>{count30d}</strong> updates in the last 30 days.
      </p>
    </div>
  )
}

function ViewToggle({ mode, setMode }) {
  return (
    <div className="flex gap-2 items-center mb-4">
      <button
        onClick={() => setMode('cards')}
        className={`px-3 py-1 rounded border ${mode === 'cards' ? 'bg-gray-100' : 'bg-white'}`}
        aria-pressed={mode === 'cards'}
      >Cards</button>
      <button
        onClick={() => setMode('timeline')}
        className={`px-3 py-1 rounded border ${mode === 'timeline' ? 'bg-gray-100' : 'bg-white'}`}
        aria-pressed={mode === 'timeline'}
      >Timeline</button>
    </div>
  )
}

/* -------- Data fetching & parsing -------- */

async function fetchChangelogIndex() {
  const res = await fetch(REPO_LIST_URL, {
    headers: { Accept: 'application/vnd.github.v3+json' }
  })
  if (!res.ok) throw new Error(`GitHub API error: ${res.status}`)
  const files = await res.json()
  return (Array.isArray(files) ? files : []).filter(f => f.name.endsWith('.mdx'))
}

function parseDateFromName(name) {
  const m = name.match(/^(\d{4}-\d{2}-\d{2})-/)
  return m ? m[1] : null
}

async function fetchFrontmatter(file) {
  const rawRes = await fetch(file.download_url)
  const raw = await rawRes.text()
  const fm = parseFrontmatter(raw)
  const summary = (fm.description ?? extractFirstParagraph(raw))?.slice(0, 260) ?? ''
  const dateStr = fm.date ?? parseDateFromName(file.name) ?? ''
  const url = `/changelogs/${file.name.replace(/\.mdx$/, '')}`
  return {
    title: fm.title || humanizeSlug(file.name),
    date: dateStr,
    description: summary,
    thumbnail: fm.thumbnail || '',
    video: fm.video || '',
    category: fm.category || fm.type || '',
    url
  }
}

function parseFrontmatter(md) {
  const m = md.match(/^---\n([\s\S]*?)\n---/)
  if (!m) return {}
  const out = {}
  let key = null
  for (const lineRaw of m[1].split('\n')) {
    const line = lineRaw.trim()
    if (!line) continue
    const kv = line.match(/^([A-Za-z0-9_-]+):\s*(.*)$/)
    if (kv) {
      key = kv[1]
      let val = kv[2]
      if ((val.startsWith('"') && val.endsWith('"')) || (val.startsWith("'") && val.endsWith("'"))) {
        val = val.slice(1, -1)
      }
      out[key] = val
    } else if (key && line.startsWith('- ')) {
      if (!Array.isArray(out[key])) out[key] = []
      out[key].push(line.slice(2).trim())
    }
  }
  return out
}

function extractFirstParagraph(md) {
  md = md.replace(/^---[\s\S]*?---/, '').trim()
  const lines = md
    .split('\n')
    .filter(Boolean)
    .filter(l => !l.startsWith('import ') && !l.startsWith('export '))
  return lines.slice(0, 4).join(' ')
}

function humanizeSlug(name) {
  const noExt = name.replace(/\.mdx$/, '')
  const noDate = noExt.replace(/^\d{4}-\d{2}-\d{2}-/, '')
  return noDate.replace(/-/g, ' ').replace(/\b\w/g, m => m.toUpperCase())
}

/* -------- UI helpers -------- */

function isNew(dateStr) {
  const d = new Date(dateStr)
  if (isNaN(d)) return false
  const days = (Date.now() - d.getTime()) / (1000 * 60 * 60 * 24)
  return days <= 14
}

function fmtDate(dateStr) {
  const d = new Date(dateStr)
  if (isNaN(d)) return dateStr || ''
  return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })
}

function monthKey(dateStr) {
  const d = new Date(dateStr)
  if (isNaN(d)) return 'Unknown'
  return d.toLocaleDateString(undefined, { year: 'numeric', month: 'long' })
}

function countLast30(items) {
  const cutoff = Date.now() - 30 * 24 * 60 * 60 * 1000
  return items.filter(i => !isNaN(new Date(i.date)) && new Date(i.date).getTime() >= cutoff).length
}

/* -------- Cards -------- */

function Card({ item }) {
  return (
    <a href={item.url} className="block border rounded-lg p-4 hover:shadow-sm transition">
      <div className="flex items-start gap-3">
        {item.thumbnail ? (
          <img src={item.thumbnail} alt="" className="w-16 h-16 object-cover rounded-md" loading="lazy" />
        ) : item.video ? (
          <div className="w-16 h-16 bg-black/5 rounded-md flex items-center justify-center text-xs">ðŸŽ¬</div>
        ) : (
          <div className="w-16 h-16 bg-black/5 rounded-md" />
        )}
        <div className="min-w-0">
          <div className="flex items-center gap-2 text-xs text-gray-500">
            <span>{fmtDate(item.date)}</span>
            {item.category && <span aria-l
