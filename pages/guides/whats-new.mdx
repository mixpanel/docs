---
title: "What's New"
description: "Auto-updating highlights from Mixpanel Changelogs"
---

import { useEffect, useMemo, useRef, useState } from 'react'
import { getPagesUnderRoute } from 'nextra/context'

/* Option 1 — Horizontal scrolling tiles */

export const changelogPages = getPagesUnderRoute('/changelogs')

export default function WhatsNewPage() {
  const DEFAULT_LIMIT = 16

  // Build items from local pages
  const items = useMemo(() => {
    const parseDate = (s = '') => {
      const m = s.match(/(\d{4}-\d{2}-\d{2})/)
      return m ? m[1] : ''
    }
    const humanize = (s = '') =>
      s.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase())

    return (changelogPages || [])
      .map((p) => {
        const fm = p.frontMatter || p.meta || {}
        const route = p.route || ''
        if (!/\/changelogs\/.+/.test(route)) return null
        const name = p.name || route.split('/').pop() || ''
        const date = fm.date || parseDate(name) || parseDate(route)
        return {
          url: route,
          title: fm.title || p.title || humanize(name),
          date,
          description: fm.description || '',
          thumbnail: fm.thumbnail || '',
          video: fm.video || '',
          category: fm.category || fm.type || ''
        }
      })
      .filter(Boolean)
      .sort((a, b) => new Date(b.date || '') - new Date(a.date || ''))
  }, [])

  const shipped30d = useMemo(() => {
    const cutoff = Date.now() - 30 * 24 * 60 * 60 * 1000
    return items.filter(i => !isNaN(new Date(i.date)) && new Date(i.date).getTime() >= cutoff).length
  }, [items])

  const isNew = (dateStr) => {
    const d = new Date(dateStr); if (isNaN(d)) return false
    const days = (Date.now() - d.getTime()) / (1000 * 60 * 60 * 24)
    return days <= 14
  }
  const fmtDate = (dateStr) => {
    const d = new Date(dateStr); if (isNaN(d)) return dateStr || ''
    return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' })
  }

  const Card = ({ item }) => (
    <a href={item.url} className="block h-full border rounded-2xl p-4 hover:shadow-sm transition bg-white/5">
      <div className="flex items-start gap-3">
        {item.thumbnail ? (
          <img src={item.thumbnail} alt="" className="w-16 h-16 object-cover rounded-md" loading="lazy" />
        ) : item.video ? (
          <div className="w-16 h-16 bg-black/10 rounded-md flex items-center justify-center text-xs">Video</div>
        ) : (
          <div className="w-16 h-16 bg-black/10 rounded-md" />
        )}
        <div className="min-w-0">
          <div className="flex items-center gap-2 text-xs text-gray-500">
            <span>{fmtDate(item.date)}</span>
            {item.category && <span aria-label="category">• {item.category}</span>}
            {isNew(item.date) && <span className="ml-2 inline-block px-1.5 py-0.5 text-[10px] rounded bg-emerald-100 text-emerald-700">NEW</span>}
          </div>
          <h3 className="mt-1 text-base font-medium leading-snug line-clamp-2">{item.title}</h3>
          {item.description && <p className="mt-1 text-sm opacity-80 line-clamp-3">{item.description}</p>}
        </div>
      </div>
    </a>
  )

  // ------- HORIZONTAL SCROLLER -------
  const Tiles = ({ items, limit = DEFAULT_LIMIT }) => {
    const shown = items.slice(0, limit)
    const ref = useRef(null)
    const [canScroll, setCanScroll] = useState(false)
    const [progress, setProgress] = useState(0)

    useEffect(() => {
      const el = ref.current
      if (!el) return
      const update = () => {
        const max = el.scrollWidth - el.clientWidth
        setCanScroll(max > 0)
        setProgress(max <= 0 ? 0 : el.scrollLeft / max)
      }
      update()
      el.addEventListener('scroll', update, { passive: true })
      window.addEventListener('resize', update)
      return () => {
        el.removeEventListener('scroll', update)
        window.removeEventListener('resize', update)
      }
    }, [shown.length])

    const page = () => Math.max(240, Math.floor((ref.current?.clientWidth || 0) * 0.9))
    const scrollLeft = () => ref.current?.scrollBy({ left: -page(), behavior: 'smooth' })
    const scrollRight = () => ref.current?.scrollBy({ left: page(), behavior: 'smooth' })

    return (
      <div className="relative">
        {/* Scroll container */}
        <div
          ref={ref}
          className="flex overflow-x-auto gap-4 pb-8 snap-x snap-mandatory scroll-smooth"
          style={{
            WebkitOverflowScrolling: 'touch',
            maskImage: 'linear-gradient(to right, transparent, black 24px, black calc(100% - 24px), transparent)',
            WebkitMaskImage: 'linear-gradient(to right, transparent, black 24px, black calc(100% - 24px), transparent)',
            scrollbarWidth: 'none', msOverflowStyle: 'none'
          }}
          aria-label="Latest updates"
        >
          {shown.map(i => (
            <div key={i.url} className="snap-start shrink-0 w-80">
              <Card item={i} />
            </div>
          ))}
        </div>

        {/* Progress bar */}
        {canScroll && (
          <div className="absolute left-0 right-0 bottom-2 h-1 rounded-full bg-gray-500/30 overflow-hidden">
            <div className="h-full bg-fuchsia-500" style={{ width: `${Math.round(progress * 100)}%` }} />
          </div>
        )}

        {/* Arrow controls */}
        {canScroll && (
          <>
            <button
              onClick={scrollLeft}
              aria-label="Previous"
              className="absolute right-16 bottom-8 translate-y-1/2 rounded-full border bg-white/90 text-black px-3 py-2 shadow"
            >
              &lt;
            </button>
            <button
              onClick={scrollRight}
              aria-label="Next"
              className="absolute right-4 bottom-8 translate-y-1/2 rounded-full border bg-white/90 text-black px-3 py-2 shadow"
            >
              &gt;
            </button>
          </>
        )}
      </div>
    )
  }
  // ------------------------------------

  return (
    <div className="mx-auto max-w-6xl">
      <div className="mb-6">
        <h1 className="text-3xl font-semibold tracking-tight">New releases</h1>
        <p className="mt-1 text-sm opacity-80">
          Learn more about our newly released capabilities. We shipped <strong>{shipped30d}</strong> updates in the last 30 days.
        </p>
      </div>

      <Tiles items={items} />

      <div className="mt-8 text-sm opacity-70">
        Do not see what you are looking for? See the full <a className="underline" href="/changelogs">Changelog</a>.
      </div>
    </div>
  )
}
